def changelogOut = new File(project.buildDir, 'changelog.md')
task writeChangelog(type: DefaultTask) {
    doLast {
        changelogOut.text = 'abc'
    }
}

def isPreRelease = project.version.endsWith('-pre')
def isFullRelease = !isPreRelease && project.version.endsWith('-SNAPSHOT')

jreleaser {
    project {
        name = 'Pdx-Unlimiter'
        description = 'A smart savegame manager, editor, and toolbox for all current major Paradox Grand Strategy games.'
        website = 'https://github.com/crschnick/pdx_unlimiter'
        authors = ['Christopher Schnick']
        license = 'GPL3'
        copyright = ' '
    }

    release {
        github {
            skipRelease = !isFullRelease && !isPreRelease
            owner = 'crschnick'
            overwrite = true
            tagName = '{{projectVersion}}'

            token = hasProperty("PDXU_GITHUB_WEBHOOK") ? property("PDXU_GITHUB_WEBHOOK") : System.getenv("JRELEASER_GITHUB_TOKEN")

            files = true
            artifacts = true
            checksums = false
            signatures = false

            prerelease {
                enabled = true
                pattern = '.*-pre'
            }

            update {
                enabled = true
                section('ASSETS')
            }

            changelog {
                enabled = false
            }
        }
    }
    distributions {
        app {
            artifact {
                distributionType = 'BINARY'
                path = 'build/pdx_unlimiter-windows.zip'
                platform = 'windows'
            }
            artifact {
                distributionType = 'BINARY'
                path = 'build/pdx_unlimiter-linux.zip'
                platform = 'linux'
            }
        }
    }

    announce {
        discord {
            active = 'ALWAYS'

            webhook = hasProperty("PDXU_DISCORD_WEBHOOK") ? property("PDXU_DISCORD_WEBHOOK") : System.getenv("JRELEASER_DISCORD_WEBHOOK")

            messageTemplate = isFullRelease ? 'misc/discord_full.tpl' : (isPreRelease ? 'misc/discord_pre.tpl' : 'misc/discord.tpl')
        }
    }
}